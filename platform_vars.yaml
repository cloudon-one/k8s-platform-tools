common:
  provider: "aws"
  aws_account_id: "111122223333"
  domain: "cloudon.work"
  statebucketsuffix: tf-state-010
  owner: "cloudon"
  default_region: &DefReg "us-east-2"
  vpc_id: "vpc-XXXXXXXXXXXXXX"
  private_subnet_ids: ["subnet-XXXXXXXXXXXXXX", "subnet-XXXXXXXXXXXXXX", "subnet-XXXXXXXXXXXXXX"]
  eks_cluster_name: "dev-eks-cluster"
  environment: "dev"
  route53_zone_id: "Z0123456789ABCDEF"
  eks_oidc_provider: &oidc_provider "oidc.eks.us-west-2.amazonaws.com/id/EXAMPLED539D4633E53DE1B71EXAMPLE"
  eks_oidc_provider_arn: &oidc_provider_arn "arn:aws:iam::111122223333:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/EXAMPLED539D4633E53DE1B71EXAMPLE"
  common_tags:
    Environment: "dev"
    Owner: "cloudon"
    ManagedBy: "Terragrunt"
    Team: "platform"
    Component: "platform"
    ClusterName: "dev-eks-cluster"


Platform:
  Tools: 
    airflow:
      inputs:
        airflow_version: "2.7.1"
        instance_type: "t3.medium"

    argocd:
      inputs:
        argocd_version: "2.1.2"
        admin_password: "demo-password-123!"
        metrics_retention: "7d"
        alert_slack_webhook: "https://hooks.slack.com/services/XXXXX/YYYYY/ZZZZZ"
        alert_email_to: "platform-alerts@cloudon.work"
        repositories:
          - name: "infrastructure"
            url: "https://github.com/cloudon-one/aws-terragrunt-configuration.git"
            path: "kubernetes"
            credentials:
              username: "git-user"
              password: "github-pat-token"
            type: "git"      
          - name: "applications"
            url: "https://github.com/cloudon-one/aws-cleaner.git"
            path: "kubernetes/apps"
            credentials:
              ssh_private_key: |
                -----BEGIN RSA PRIVATE KEY-----
                MIIEpAIBAAKCAQEAxxxx
                ... (SSH private key content) ...
                -----END RSA PRIVATE KEY-----
          - name: "private-gitlab" #example of private gitlab repository
            url: "https://gitlab.company.com/platform/services.git"
            path: "manifests"
            credentials:
              tls_client_cert: |
                -----BEGIN CERTIFICATE-----
                MIIDXTCCAkWgAwIBAgIJALXXX
                ... (Client certificate content) ...
                -----END CERTIFICATE-----
              tls_client_cert_key: |
                -----BEGIN PRIVATE KEY-----
                MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIB
                ... (Client certificate key content) ...
                -----END PRIVATE KEY-----
            insecure: false     
        github_apps: # example of GitHub App configuration
          - id: "123456"
            installation_id: "654321"
            private_key: |
              -----BEGIN RSA PRIVATE KEY-----
              MIIEowIBAAKCAQEAxxxx
              ... (GitHub App private key content) ...
              -----END RSA PRIVATE KEY-----  
        repositories_cert:
          - server_name: "gitlab.company.com"
            cert_data: |
              -----BEGIN CERTIFICATE-----
              MIIDfTCCAmWgAwIBAgIJALXXX
              ... (CA certificate content) ...
              -----END CERTIFICATE-----   
        git_repositories: # example of Git repositories configuration
          - name: "frontend-app"
            url: "https://github.com/cloudon-one/frontend.git"
            path: "k8s/base"
          - name: "backend-services"
            url: "https://github.com/cloudon-one/backend.git"
            path: "deploy/overlays/dev"
          - name: "shared-resources"
            url: "git@github.com:cloudon-one/shared.git"
            path: "common/resources"         

    cert-manager:
      inputs:
        service_account:
          name: "cert-manager"
          annotations:
            eks.amazonaws.com/role-arn: "arn:aws:iam::${local.platform_vars.common.aws_account_id}:role/${local.platform_vars.common.environment}-cert-manager-role"
        acme:
          acme_email: "platform@${local.platform_vars.common.domain}"
          server: >
            ${local.platform_vars.common.environment == "prod" 
            ? "https://acme-v02.api.letsencrypt.org/directory" 
            : "https://acme-staging-v02.api.letsencrypt.org/directory"}
        cluster_issuer:
          create: true
          name: "letsencrypt-${local.platform_vars.common.environment}"
        dns_challenge:
          enabled: true
          zone_id: "${local.platform_vars.common.route53_zone_id}"
          region: "${local.platform_vars.common.aws_region}"
        aws:
          create_iam_role: true
          role_name: "${local.platform_vars.common.environment}-cert-manager"
          region: "${local.platform_vars.common.aws_region}"
          iam:
            oidc:
              provider_arn: "${local.platform_vars.common.eks_oidc_provider_arn}"
              provider_url: "${local.platform_vars.common.eks_oidc_provider}"
        additional_set_values:
          - name: "global.priorityClassName"
            value: "system-cluster-critical"
        tags:
          Environment: "dev"
          Component: "cert-manager"
          ManagedBy: "terraform"
          Team: "platform"
          ClusterName: "dev-eks-cluster"

    external-dns:
      inputs:

    external-secrets:
      inputs:
        chart_version: "0.9.9"
        service_account:
          name: "external-secrets"
          annotations:
            eks.amazonaws.com/role-arn: "arn:aws:iam::${local.platform_vars.common.aws_account_id}:role/${local.platform_vars.common.environment}-external-secrets-role"
        oidc:
          provider_arn: "arn:aws:iam::${local.platform_vars.common.aws_account_id}:oidc-provider/${local.platform_vars.common.eks_oidc_provider}"
          provider_url: "${local.platform_vars.common.eks_oidc_provider}"    
        kms:
          key_arns: 
          - "arn:aws:kms:${local.platform_vars.common.default_region}:${local.platform_vars.common.aws_account_id}:key/${local.platform_vars.common.environment}-key"   
        secrets_manager:
          arns: 
          - "arn:aws:secretsmanager:${local.platform_vars.common.default_region}:${local.platform_vars.common.aws_account_id}:secret:${local.platform_vars.common.environment}-secrets"
        parameter_store:
          arns:
          - "arn:aws:ssm:${local.platform_vars.common.default_region}:${local.platform_vars.common.aws_account_id}:parameter/${local.platform_vars.common.environment}/*"  
        tags:
          Environment: "dev"
          Cluster: "dev-eks-cluster"
          ManagedBy: "Terragrunt"  

        


    istio:
      inputs:

    jeager:
      inputs:

    karpenter:
      inputs:

    kong-ingress:
      inputs:

    kubecost:
      inputs:

    loki-stack:
      inputs:                                    
  